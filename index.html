<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />

  </head>
  <body>
    <div class="main-user">
      <h4 class="username"></h4>
      <!-- Add here a field to post new tweets -->
    </div>
    <div class="following">
      <h4>Following</h4>
      <ul class="users-list"></ul>
    </div>
    <div class="tweets">
      <h4>All tweets</h4>
      <button>Get new tweets<span class="counter"> (0)</span></button>
      <ul class="tweets-list"></ul>
    </div>
    <script>

      $(document).ready(function(){

        //Index of the last tweet displayed
        var tweetLastIndex = 0;

        //Acces to the list of tweets placeholder
        var $tweets = $('.tweets-list');

        //Function refreshing the counter i.e. the number of new tweets not displayed
        var refreshCounter = function(tweetLastIndex) {
          var counterNum = streams.home.length - 1 - tweetLastIndex;
          $('.counter').text(' (' + counterNum + ')');          
        }

        //Function refreshing the list of tweets
        var refreshTweets = function() {
          var $tweet = $tweets.find('li').first();
          var index = streams.home.length - 1;
          tweetLastIndex = index;
          while(index >= 0){
            var tweet = streams.home[index];
            $tweet.text('@' + tweet.user + ': ' + tweet.message + ', created at: ' + tweet.created_at);
            $tweet = $tweet.next();
            index -= 1;          
          }
          refreshCounter(tweetLastIndex);
        }

        //INITIALIZATION
        //Display username
        var name = prompt("What's your name?");
        $('.username').text(name);

        //Display the list of users I follow
        $('.users-list').append('<li class="highlight"><a href="#">All users</a></li>');
        for (var prop in streams.users) {
          $('.users-list').append('<li><a href="#">' + prop + '</a></li>');
        }

        //Display the first 10 tweets just after page loading
        var index = streams.home.length - 1;
        tweetLastIndex = index;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $('<li></li>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message + ', created at: ' + tweet.created_at);
          $tweet.appendTo($tweets);
          index -= 1;
        }

        //PAGE EVENTS
        //Refresh the new tweets counter every 2 sec
        setInterval(function() {
          refreshCounter(tweetLastIndex);
        }, 2000);

        //Refresh the list of tweets if the button is clicked
        $('.tweets').on('click', 'button', refreshTweets);

        //Fiter the list of tweets if a user is clicked
        $('.users-list').on('click', 'li', function(event) {
          event.preventDefault();
          $(this).closest('.users-list').find('li').removeClass('highlight');
          $(this).addClass('highlight');
        });


      });

    </script>
  </body>
</html>
